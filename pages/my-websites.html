<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Websites - SPX STUDIO</title>
    <link rel="stylesheet" href="../public/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="spx_studio-removebg-preview.png">
   <style>
        /* My Websites page specific styles */
        .websites-section {
            padding: 80px 0;
            background-color: var(--light-color);
        }
        
        .websites-container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }
        
        .websites-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .websites-header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .websites-list {
            margin-bottom: 30px;
        }
        
        .website-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s ease;
        }
        
        .website-item:hover {
            background-color: #f8f9fa;
        }
        
        .website-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .website-icon {
            width: 50px;
            height: 50px;
            background-color: var(--primary-color);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .website-details h3 {
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .website-url {
            color: #666;
            font-size: 0.9rem;
        }
        
        .website-meta {
            color: #666;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .website-actions {
            display: flex;
            gap: 10px;
        }
        
        .website-btn {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .website-btn.view {
            background-color: var(--primary-color);
            color: white;
        }
        
        .website-btn.edit {
            background-color: #6c757d;
            color: white;
        }
        
        .website-btn.delete {
            background-color: #dc3545;
            color: white;
        }
        
        .website-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .no-websites {
            text-align: center;
            padding: 30px;
            color: #666;
        }
        
        .create-new {
            margin-top: 30px;
            text-align: center;
        }
        
        .create-btn {
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .create-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .premium-badge {
            display: inline-block;
            background-color: #ff6b6b;
            color: white;
            padding: 5px 10px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .plan-badge {
            display: inline-block;
            background-color: #6c757d;
            color: white;
            padding: 3px 8px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .plan-badge.basic {
            background-color: #17a2b8;
        }
        
        .plan-badge.standard {
            background-color: #28a745;
        }
        
        .plan-badge.premium {
            background-color: #007bff;
        }
        
        .login-section {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
        
        .login-form {
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            text-align: left;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .login-btn:hover {
            opacity: 0.9;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            margin: 0;
            color: var(--primary-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-btn {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            font-weight: 600;
            cursor: pointer;
        }
        
        .modal-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-btn.secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .modal-btn.danger {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>SPX STUDIO</h1>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="events.html">Events</a></li>
                    <li><a href="premium.html">Premium</a></li>
                    <li><a href="create.html">Create</a></li>
                    <li><a href="upload.html">Upload</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
            <div class="auth-buttons" id="auth-buttons">
                <a href="login.html" class="login-btn">Login</a>
                <a href="signup.html" class="signup-btn">Sign Up</a>
            </div>
            <div class="user-menu" id="user-menu" style="display: none;">
                <a href="dashboard.html" class="user-menu-btn">
                    <i class="fas fa-user-circle"></i>
                    <span id="menu-username">Username</span>
                </a>
            </div>
            <div class="mobile-menu">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </header>

    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1>My Websites</h1>
                <p>Manage all your web projects created with SPX STUDIO</p>
            </div>
        </div>
    </section>

    <section class="websites-section">
        <div class="container">
            <div class="websites-container">
                <div id="login-container" class="login-section">
                    <h2>Access Your Websites</h2>
                    <p>Please enter your user ID and password to view your websites</p>
                    
                    <div class="login-form">
                        <div class="form-group">
                            <label for="user-id">User ID</label>
                            <input type="text" id="user-id" placeholder="Enter your user ID">
                        </div>
                        
                        <div class="form-group">
                            <label for="user-password">Password</label>
                            <input type="password" id="user-password" placeholder="Enter your password">
                        </div>
                        
                        <button id="login-btn" class="login-btn">Access Websites</button>
                    </div>
                </div>
                
                <div id="websites-container" style="display: none;">
                    <div class="websites-header">
                        <h1>My Websites</h1>
                        <p>Manage all your web projects and domains</p>
                        <div id="user-info" class="user-info">
                            <p>Logged in as: <span id="current-user">User123</span> <span id="premium-badge" class="premium-badge" style="display: none;">Premium</span></p>
                        </div>
                    </div>
                    
                    <div id="websites-list" class="websites-list">
                        <!-- Websites will be loaded here -->
                    </div>
                    
                    <div class="create-new">
                        <a href="create.html" class="create-btn">
                            <i class="fas fa-plus"></i> Create New Website
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Delete Website</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="delete-website-name">Website Name</strong>?</p>
                <p>This action cannot be undone, and you will lose all data associated with this website.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary cancel-delete">Cancel</button>
                <button class="modal-btn danger confirm-delete">Delete</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>SPX STUDIO</h2>
                    <p>Your creative journey starts here</p>
                </div>
                <div class="footer-links">
                    <div class="footer-section">
                        <h3>Quick Links</h3>
                        <ul>
                            <li><a href="../index.html">Home</a></li>
                            <li><a href="about.html">About</a></li>
                            <li><a href="services.html">Services</a></li>
                            <li><a href="blog.html">Blog</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h3>Resources</h3>
                        <ul>
                            <li><a href="premium.html">Premium Templates</a></li>
                            <li><a href="tutorials.html">Tutorials</a></li>
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="support.html">Support</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h3>Connect With Us</h3>
                        <div class="social-links">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 SPX STUDIO. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../public/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userId = localStorage.getItem('userId');
            
            if (!isLoggedIn || !userId) {
                // Redirect to login page if not logged in
                alert('Please log in to view your websites.');
                window.location.href = 'login.html';
                return;
            }
            
            // Elements
            const loginContainer = document.getElementById('login-container');
            const websitesContainer = document.getElementById('websites-container');
            const websitesList = document.getElementById('websites-list');
            const userIdInput = document.getElementById('user-id');
            const userPasswordInput = document.getElementById('user-password');
            const loginBtn = document.getElementById('login-btn');
            const currentUserSpan = document.getElementById('current-user');
            const premiumBadge = document.getElementById('premium-badge');
            const deleteModal = document.getElementById('delete-modal');
            const deleteWebsiteName = document.getElementById('delete-website-name');
            const cancelDeleteBtn = document.querySelector('.cancel-delete');
            const confirmDeleteBtn = document.querySelector('.confirm-delete');
            const closeModalBtn = document.querySelector('.close-modal');
            
            // Variables
            let currentUserId = '';
            let currentUserPassword = '';
            let websiteToDelete = '';
            let isPremiumUser = false;
            
            // Check if user is already logged in
            const savedUserId = localStorage.getItem('userId');
            const savedPassword = localStorage.getItem('userPassword');
            
            if (savedUserId && savedPassword) {
                currentUserId = savedUserId;
                currentUserPassword = savedPassword;
                login(currentUserId, currentUserPassword);
            }
            
            // Login button event
            loginBtn.addEventListener('click', () => {
                const userId = userIdInput.value.trim();
                const password = userPasswordInput.value;
                
                if (!userId) {
                    alert('Please enter your user ID');
                    return;
                }
                
                login(userId, password);
            });
            
            // Login function
            function login(userId, password) {
                // Store credentials
                currentUserId = userId;
                currentUserPassword = password;
                
                // Save to localStorage
                localStorage.setItem('userId', userId);
                localStorage.setItem('userPassword', password);
                
                // Display user info
                currentUserSpan.textContent = userId;
                
                // Check premium status
                checkPremiumStatus(userId);
                
                // Load websites
                loadWebsites(userId, password);
                
                // Show websites container
                loginContainer.style.display = 'none';
                websitesContainer.style.display = 'block';
            }
            
            // Check premium status
            function checkPremiumStatus(userId) {
                fetch(`/api/user/premium-status?userId=${encodeURIComponent(userId)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            isPremiumUser = data.isPremiumUser;
                            
                            if (isPremiumUser) {
                                premiumBadge.style.display = 'inline-block';
                            } else {
                                premiumBadge.style.display = 'none';
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error checking premium status:', error);
                    });
            }
            
            // Load websites
            function loadWebsites(userId, password) {
                websitesList.innerHTML = '<div class="loading">Loading your websites...</div>';
                
                // Get projects and domains
                Promise.all([
                    fetch(`/api/projects?userId=${encodeURIComponent(userId)}&password=${encodeURIComponent(password)}`).then(res => res.json()),
                    fetch(`/api/domains?userId=${encodeURIComponent(userId)}&password=${encodeURIComponent(password)}`).then(res => res.json())
                ])
                .then(([projectsData, domainsData]) => {
                    if (!projectsData.success || !domainsData.success) {
                        throw new Error('Failed to load data');
                    }
                    
                    const projects = projectsData.projects || [];
                    const domains = domainsData.domains || [];
                    
                    // Map domains to projects
                    const projectDomains = {};
                    domains.forEach(domain => {
                        projectDomains[domain.projectId] = domain;
                    });
                    
                    if (projects.length === 0) {
                        websitesList.innerHTML = `
                            <div class="no-websites">
                                <i class="fas fa-folder-open" style="font-size: 3rem; color: #ddd; margin-bottom: 20px;"></i>
                                <h3>No websites found</h3>
                                <p>You haven't created any websites yet. Click the button below to create your first website.</p>
                            </div>
                        `;
                        return;
                    }
                    
                    // Create website items
                    websitesList.innerHTML = '';
                    projects.forEach(project => {
                        const domain = projectDomains[project.id] || null;
                        const websiteItem = document.createElement('div');
                        websiteItem.className = 'website-item';
                        
                        let planBadge = '';
                        if (domain) {
                            planBadge = `<span class="plan-badge ${domain.plan}">${domain.plan.charAt(0).toUpperCase() + domain.plan.slice(1)}</span>`;
                        }
                        
                        websiteItem.innerHTML = `
                            <div class="website-info">
                                <div class="website-icon">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <div class="website-details">
                                    <h3>${project.name} ${planBadge}</h3>
                                    <div class="website-url">${domain ? domain.domain : 'Not published'}</div>
                                    <div class="website-meta">Created: ${new Date(project.createdAt).toLocaleDateString()}</div>
                                </div>
                            </div>
                            <div class="website-actions">
                                ${domain ? `
                                    <a href="https://${domain.domain}" class="website-btn view" target="_blank">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                ` : ''}
                                <a href="create.html?project=${project.id}" class="website-btn edit">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <button class="website-btn delete" data-id="${project.id}" data-name="${project.name}">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        `;
                        
                        websitesList.appendChild(websiteItem);
                    });
                    
                    // Add event listeners to delete buttons
                    document.querySelectorAll('.website-btn.delete').forEach(btn => {
                        btn.addEventListener('click', () => {
                            websiteToDelete = btn.dataset.id;
                            deleteWebsiteName.textContent = btn.dataset.name;
                            deleteModal.classList.add('show');
                        });
                    });
                })
                .catch(error => {
                    console.error('Error loading websites:', error);
                    websitesList.innerHTML = `
                        <div class="no-websites">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: #dc3545; margin-bottom: 20px;"></i>
                            <h3>Error loading websites</h3>
                            <p>There was an error loading your websites. Please try again later.</p>
                        </div>
                    `;
                });
            }
            
            // Delete modal events
            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.classList.remove('show');
            });
            
            closeModalBtn.addEventListener('click', () => {
                deleteModal.classList.remove('show');
            });
            
            confirmDeleteBtn.addEventListener('click', () => {
                // In a real implementation, this would delete the website from the server
                alert('Website deletion would be implemented in a real application. For this demo, the website will not be deleted.');
                deleteModal.classList.remove('show');
            });
        });
    </script>
</body>
</html>